name: Build all applications

on:
  pull_request:
    branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true

      - name: Build all applications
        run: |
          echo "## 🔧 Builds Test" >> "$GITHUB_STEP_SUMMARY"
          for app in $(find ${{ github.workspace }} -maxdepth 1 -type d -not -name RIOT | sort); do
            if [ ! -f "$app/Makefile" ]; then
                echo "Makefile in $app does not exist"
                continue
            fi

            echo "Building $app"
            app_name=$(basename $app)
            if (cd "$app" && BUILD_IN_DOCKER=1 make all); then
              echo "✅ $app_name" >> "$GITHUB_STEP_SUMMARY"
            else
              echo "❌ $app_name" >> "$GITHUB_STEP_SUMMARY"
              exit 1
            fi
          done
