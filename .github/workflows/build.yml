name: Build all applications

on:
  pull_request:
    branches: [master]

env:
  APPS: |
    01-hello-world
    02-timers
    03-shell
    04-saul
    05-gpios
    06-threads
    07-events
    08-coap-basic
    09-netapi
    10-sock
    11-ble-peripheral
    12-ble-central
    rust01-hello-world
    rust02-timers
    rust03-shell
    rust04-saul
    rust05-gpio
    rust06-threads

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true

      - name: Build all applications
        run: |
          echo "## 🔧 Builds Test" >> "$GITHUB_STEP_SUMMARY"
          for app in $APPS; do
            echo "Building $app"
            if (cd "$app" && BUILD_IN_DOCKER=1 make all); then
              echo "✅ $app" >> "$GITHUB_STEP_SUMMARY"
            else
              echo "❌ $app" >> "$GITHUB_STEP_SUMMARY"
              exit 1
            fi
          done
